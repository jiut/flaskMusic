{% extends 'base.html' %}

{% block content %}
<div class="div1" style="margin-left: 500px">
    <p id="music_name" style="margin-left: 120px;font-size: 17px">{{ music_list[0]["name"] }}</p><br>
    <audio id="audio" src="{{ music_list[0]["link"] }}" controls></audio>
    <br/>
    <div style="margin-left: 45px">
        <button id="btn-play">播放</button>
        <button id="btn-stop">暂停</button>
        <button id="btn-pre">上一首</button>
        <button id="btn-next">下一首</button>
    </div>
<form action="#">
      <select name="play-modes" id="modes">
        <option value="playlist">列表循环</option>
        <option value="playsingle">单曲循环</option>
        <option value="playrandom">随机播放</option>
      </select>
</form>
</div>
<form method="post">
    <input type="text" name="search" required placeholder="搜索"><br><br>
    <input class="btn" type="submit" name="submit" value="搜索">
</form>
<ul class="music-list">
        {% for music in music_list %}
            <li id="{{ loop.index0 }}">
                    {{ music.name }}
            </li>
        {% endfor %}

</ul>


<script>
    var audio = document.getElementById("audio");
    var music_name = document.getElementById("music_name");
    var music = {{ music_list |safe}} ;//safe: It's Happening ||| tojson:It\u0027s Happening
    var num = 0;
    var mode = 0;

    //var music = [{"link": "http://m7.music.126.net/20220628094519/a8a3571f169dde1024ea2915ca296cd9/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14054238118/3937/706d/7e7b/a65b577e39ee0d8c88a2936b409f7300.mp3", "name": "Blossoms of Summer Night \u785d\u534e\u6d41\u7130"}, {"link": "http://m7.music.126.net/20220628094519/6e466db0e690ca9c89c66feaf342c110/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14051326217/1954/cfa5/a2ee/894fd07ed447d3f230ac75fe42ece273.mp3", "name": "\u8ba9\u98ce\u544a\u8bc9\u4f60"}, {"link": "http://m7.music.126.net/20220628094519/01117cc6202e6fc9ae27e9c5a271dc98/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14056375748/a748/8ca7/e851/079e1a16d3135fcf87d02d778383f00c.mp3", "name": "Rex Incognito \u5c18\u4e16\u95f2\u6e38"}, {"link": "http://m8.music.126.net/20220628094519/806c4a2d84f94f09a9cbb53a1e39d3ba/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14055946823/f9bd/11db/8e30/d89af6f28ffe42f7c7242d33a5f1ca80.mp3", "name": "Termination of Desires \u4f55\u5984\u4f55\u6267"}, {"link": "http://m7.music.126.net/20220628094520/18cf91406c07aa419dafb84192e1a760/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14055370367/ea35/91b8/431d/bb51f855984fc53d09fbadf8e3836724.mp3", "name": "\u795e\u5973\u5288\u89c2\u00b7\u5524\u60c5 Devastation and Redemption"}, {"link": "http://m7.music.126.net/20220628094520/b016e25e6b4c4360e8ba26aa3e1b4ae2/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/13445717311/bff2/3095/bb0f/45a419caa8a0d2cb833126429cede07d.mp3", "name": "\u7483\u4e91\u6708\u6d77"}, {"link": "http://m8.music.126.net/20220628094520/da3bcc148a0728ea2cb2b14bd43e0c7a/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14052356188/409a/e847/4b2a/35102ee5ab985b68a3b9bc39a329e57e.mp3", "name": "Rage Beneath the Mountains \u5ca9\u58d1\u4e4b\u5d29"}, {"link": "http://m801.music.126.net/20220628094520/e2e56f229d2b7dfb0027630fc7ee50b5/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/13898399530/9ec9/1341/6dae/652741d188173763b4b88cabe7f41ece.mp3", "name": "Thunderings of the Merciless \u96f7\u9706\u7684\u5a01\u5149"}, {"link": "http://m8.music.126.net/20220628094521/fad00d2e764831c7973a541f00d4910c/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14055958350/9dee/623e/4c76/0667693ae1fa9c221d0c1f7f30914546.mp3", "name": "Drifter\u0027s Destiny \u8352\u6ce2\u691b\u53f6"}, {"link": "http://m7.music.126.net/20220628094521/58178bf543e6e6c19373473282bbc644/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14053901440/c3f9/9bf1/7aa3/f490c056525f996a57e7f1d19911980b.mp3", "name": "Let\u0027s Go, Crimson Knight! \u771f\u7ea2\u9a91\u58eb\uff0c\u51fa\u53d1\uff01"}, {"link": "http://m701.music.126.net/20220628094521/b0355e34c32f8965da4b4ea133918cc7/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/14438419261/0d8b/43d9/5d15/bff63514b835744491de116899bb0c50.mp3", "name": "\u3010\u539f\u795e\u5168\u89d2\u8272\u3011\u68a6\u56de\u8fd8"}, {"link": "http://m7.music.126.net/20220628094521/6cab50f7e7e2fcdfe7b8809c4bb41caa/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14055846492/fa9a/121a/fd33/2a0c6f1a43de64b3cbc4fc2330ca807e.mp3", "name": "Devotion of the Keeper \u8d64\u80c6\u662d\u5fe0"}, {"link": "http://m8.music.126.net/20220628094522/46812a6ba5936bc1985cc936a68aa926/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14053236324/f4fc/16c4/7074/26a10dd469af7af6636fbf1460f64bdc.mp3", "name": "Tale of the Yakshas \u591c\u53c9\u7684\u56de\u53d9"}, {"link": "http://m701.music.126.net/20220628094522/2bd26f4dfcbb3d17a00de281f63becf8/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/8893964827/b413/5872/a36d/1071b0ac2803e362cf569d02e8491fbf.mp3", "name": "\u3010\u539f\u795e - \u80e1\u6843\u3011\u5341\u53ea\u4e18\u4e18\u4eba\uff08\u4e18\u4e18\u8c23\uff09"}, {"link": "http://m801.music.126.net/20220628094523/edc550469d034b7d1f0af1eb41a8766a/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/9610642837/48bc/bc80/4773/4da4da75f45aa716e722bb1699d0c36b.mp3", "name": "\u706b\u82b1\u9a91\u58eb\uff08\u539f\u795e \u53ef\u8389\u540c\u4eba\u66f2\uff09"}, {"link": "http://m801.music.126.net/20220628094523/9e7522f6eddbe4edd4e73468dd138db0/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/11475736952/b90c/6314/f60f/e7fce3cb8fb53ada445302ebff2a5e97.mp3", "name": "\u8d77\u98ce\u4e86\u3010\u539f\u795e\u4e00\u5468\u5e74\u3011"}, {"link": "http://m801.music.126.net/20220628094523/2e8d0e26192d3620a7f6fb285e5a9cc0/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/13898296369/357d/dd1b/1e4b/8f0a2384df4b99db0a31b91d1dac0350.mp3", "name": "Ruu\u0027s Melody \u963f\u7460\u7684\u6b4c"}, {"link": "http://m701.music.126.net/20220628094524/df4cfb0b70c016012088e26d9fbd8c09/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/11139541024/5e90/43f2/5325/fd2171cf627454856657b4c72c544cf2.mp3", "name": "\u98ce\u4e0e\u98de\u9e1f"}, {"link": "http://m701.music.126.net/20220628094524/76cc4117beb567515c7d2ca88fa9b5cd/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/15064497501/c451/1607/dee7/680373c419a74c3932f6515fd9765ab4.mp3", "name": "Lithic Oath \u4e07\u58d1\u5343\u5ca9"}, {"link": "http://m8.music.126.net/20220628094524/5c68590443fea049eabb456247d2d68a/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14056330891/acb1/a79d/8009/ec50adf449ca6a31947c69b184dee960.mp3", "name": "Through the Eyes of a Dragon \u521b\u9f99\u70b9\u775b"}, {"link": "http://m801.music.126.net/20220628094524/0452cc664ddb53fb18e7a54717e54c12/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/14819044672/8663/ef17/04f8/6d315fba3ad381456a730b7a3d0ee0be.mp3", "name": "\u539f\u795e|\u9b48-\u300a\u70df\u706b\u4e4b\u9080\u300b"}, {"link": "http://m701.music.126.net/20220628094525/ba128006da35294c2d8d7cab4054a1de/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/4379579301/28fa/ac58/107a/ef34ecadea571fa20d52a189288d039f.mp3", "name": "\u82ad\u82ad\u62c9\u51b2\u9e2d\uff08\u539f\u795e\u89d2\u8272\u540c\u4eba\u66f2\uff09"}, {"link": "http://m801.music.126.net/20220628094525/1e514f7a645894580b0da0d2f46c4a83/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/13898395469/d7c3/9a22/7cb2/1a15cc4438000f85d8242dd684f40a63.mp3", "name": "The Almighty Violet Thunder \u7a3b\u5149\u795e\u9e23"}, {"link": "http://m7.music.126.net/20220628094525/febcd9facf073a09f0ab085835c5c0fe/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14056009863/dde6/8c49/3826/7c2e46c550371d7df96e4c8e63402d81.mp3", "name": "Dance of Aphros \u6d6a\u6cab\u8d77\u821e"}, {"link": "http://m801.music.126.net/20220628094526/4569f02431dfdc4d6e79a41d472669e6/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/10795015764/4566/e762/7932/90e279ca60473023d3c468b41586afdc.mp3", "name": "\u3010\u539f\u795e\u3011\u96f7\u795e\u4ec0\u4e48\u7684\u4e0d\u5e72\u4e86\u5566\uff01\uff08\u5deb\u5154\u83cc remix\uff09"}, {"link": "http://m8.music.126.net/20220628094526/194df0ca34e467a507cc68687c2813e1/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14055385185/67f0/a596/1262/cb35d3a962dc6349a7c834ec752d6213.mp3", "name": "Liyue \u7483\u6708"}, {"link": "http://m8.music.126.net/20220628094526/a19c1e47c8a67f355343aeb4c3203f90/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14056874557/d8b2/6a27/758c/b05b8f0924ce7268c7f70f85232a81a3.mp3", "name": "Nimble as Lightning \u9706\u9713\u5feb\u96e8"}, {"link": "http://m701.music.126.net/20220628094526/8d53853efd78118c067d4d89ec3e2ae0/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/13800218849/f01f/1c48/5673/e55979d15b8816fb115894d586a284bd.mp3", "name": "\u3010\u539f\u795e\u4e09\u795e\u3011\u6d6e\u751f\u82e5\u68a6"}, {"link": "http://m7.music.126.net/20220628094527/5a2aab29e564a4e5a8424ededb655ba0/ymusic/obj/w5zDlMODwrDDiGjCn8Ky/14056995444/34f4/07f5/d50d/d9cca263538b9cf23d6c09977c78e724.mp3", "name": "\u95e8\u7684\u53e6\u4e00\u7aef"}, {"link": "http://m801.music.126.net/20220628094527/c41ab5db378c44b818f1237c9b4ff69a/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/7665456129/344c/1f6f/3b8a/a78bc06a83efbee9722c3af676f49c41.mp3", "name": "\u3010\u539f\u795e/\u6e29\u8fea\u3011\u82e5\u4f60\u56f0\u4e8e\u65e0\u98ce\u4e4b\u5730"}];

    $(document).ready(function () {
        $("#btn-play").click(function () {
            if (audio.paused)
                audio.play();
        });

        $("#btn-stop").click(function () {
            if (audio.played) {
                audio.pause();
            }
        });

        $("#btn-pre").click(function () {
            if(mode !== 2) {
                if (num === 0) num = music.length - 1;
                else num--;
            }
            else {
                    num = temp;
                    temp--;
            }
            audio.src = music[num]["link"];
            music_name.innerHTML = music[num]["name"];
            audio.play();
        });

        $("#btn-next").click(function () {
            if(mode !== 2) {
                if (num === music.length - 1) num = 0;
                else num++;
            }
            else {
                temp = num;
                do{
                    num = Math.floor(Math.random() * music.length);
                }
                while(temp === num);
            }
            audio.src = music[num]["link"];
            music_name.innerHTML = music[num]["name"];
            audio.play();
        });

        audio.addEventListener('ended', function () {
            if(mode === 1 )
                audio.play();
            else
                $("#btn-next").click();
        }, false);

        $("li").dblclick(function () {
            num = this.id;
            audio.src = music[num]["link"];
            music_name.innerHTML = music[num]["name"];
            audio.play();
        });

        $("#modes").change(function () {
            if(this.value === "playlist"){
                mode = 0;
            }
            if(this.value === "playsingle") {
                mode = 1;
            }
            if(this.value === "playrandom"){
                mode = 2;
            }
        })
    });
    /*
    {#播放音乐#}

    function play_music() {
        if (audio.paused) {
            audio.play();
        }
    }

    {#暂停音乐#}

    function pause_music() {
        if (audio.played) {
            audio.pause();
        }
    }

    {#上一首音乐#}

    function last_music() {
        num = (num + (x.length - 2)) % (x.length - 1);
        if (typeof (music[num]) === "undefined" || music[num] === "") {
            audio.src = "/static/music/" + music[1] + ".mp3";
            music_name.innerHTML = music[1];
            audio.play();
        } else {
            audio.src = "/static/music/" + music[num] + ".mp3";
            music_name.innerHTML = music[num];
            audio.play();
        }
    }

    {#下一首音乐#}

    function next_music() {
        num = (num + (x.length + 2)) % (x.length + 1);
        if (typeof (music[num]) === "undefined" || music[num] === "") {
            audio.src = "/static/music/" + music[2] + ".mp3";
            music_name.innerHTML = music[2];
            audio.play();
        } else {
            audio.src = "/static/music/" + music[num] + ".mp3";
            music_name.innerHTML = music[num];
            audio.play();
        }
    }

    <!--自动播放下一首-->
    audio.addEventListener('ended', function () {
        next_music();
    }, false);
    */
</script>

{% endblock %}
